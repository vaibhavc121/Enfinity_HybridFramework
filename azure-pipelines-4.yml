# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- master

pool:
  vmImage: macos-latest

variables:
  BROWSERSTACK_USERNAME: 'vaibhavchavan_vXTnjK'
  BROWSERSTACK_ACCESS_KEY: 'VjyZRpR7fkRybdm1cyAb'

jobs:
  - job: BrowserStack_Test
    displayName: "Run tests on BrowserStack | Cross-version Testing"
    strategy:
      matrix:
        Chrome_Latest:
          browser: 'chrome'
          browser_version: 'latest'
        Chrome_89:
          browser: 'chrome'
          browser_version: '89'
        Firefox_Latest:
          browser: 'firefox'
          browser_version: 'latest'
        Firefox_85:
          browser: 'firefox'
          browser_version: '85'
        Edge_Latest:
          browser: 'edge'
          browser_version: 'latest'
        Edge_114:
          browser: 'edge'
          browser_version: '114'
        Safari_Latest:
          browser: 'safari'
          browser_version: 'latest'
        
    steps:
      - task: Maven@4
        inputs:
          mavenPomFile: 'pom.xml'
          goals: 'test'
          options: '-DBROWSERSTACK_USERNAME=$(BROWSERSTACK_USERNAME) -DBROWSERSTACK_ACCESS_KEY=$(BROWSERSTACK_ACCESS_KEY)'
          publishJUnitResults: true
          testResultsFiles: '**/surefire-reports/TEST-*.xml'
          testRunTitle: 'Automation Engineer (SDET)- Vaibhav Chavan'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '1.17'
          mavenVersionOption: 'Default'
          mavenAuthenticateFeed: false
          effectivePomSkip: false
          sonarQubeRunAnalysis: false
        displayName: "Build and Run Tests with Maven on BrowserStack"

      - script: |
          echo "Running tests on $(browser) version $(browser_version)"
          mvn test -Dbrowser=$(browser) -Dbrowser_version=$(browser_version)
        displayName: 'Run Cross-version Tests'
